<!DOCTYPE html>
<meta charset="utf-8">
<title>Vizualizácia dát</title>
<style>
.citytip:hover{
  stroke: #fff;
  stroke-width: 1.5px;
}
.country:hover{
  stroke: #fff;
  stroke-width: 1.5px;
}
.text{
  font-size:10px;
  text-transform:capitalize;
}
#container {
  margin:10px 10%;
  border:2px solid #000;
  border-radius: 5px;
  height:100%;
  overflow:hidden;
  background: #136fbf;
}
.hidden { 
  display: none; 
}
div.tooltip {
  color: #222; 
  background: #fff; 
  padding: .5em; 
  text-shadow: #f5f5f5 0 1px 0;
  border-radius: 2px; 
  box-shadow: 0px 0px 2px 0px #a6a6a6; 
  opacity: 0.9; 
  position: absolute;
}
.graticule {
  fill: none;
  stroke: #bbb;
  stroke-width: .5px;
  stroke-opacity: .5;
}
.equator {
  stroke: #ccc;
  stroke-width: 1px;
}
.container2 {
  width: 80%;
  margin: 70px auto;
}
.slider-container {
   width: 90%;
   max-width: 1000px;
   margin: 0 auto 50px;
}

</style>
<link rel="stylesheet" href="rSlider.min.css">
</head>
<body>

  <h1>Vizualizácia vývoja počasia</h1>


<script src="rSlider.min.js"></script>
<script src = "https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="d3-scale-radial.js"></script>

<script src="js/three.js"></script>
<script src="js/grid.js"></script>
<script src="js/heatmap.js"></script>
<script src="js/dataprocessing.js"></script>
<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://threejs.org/examples/js/renderers/CSS2DRenderer.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.2/dat.gui.min.js"></script>




<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
<script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>


<div class="container2">
        <div class="slider-container">
            <input type="text" id="slider" class="slider" />
        </div>
        <div class="slider-container">
            <input type="text" id="slider2" class="slider" />
        </div>
        
        
        
        
    </div>

  <div id="container"></div>
 
  
  <div id="heatLayer"></div>
 
    
    
    <script>
	//chrome --allow-file-access-from-files
        (function () {
            'use strict';

            var init = function () {                

                var slider2 = new rSlider({
                    target: '#slider2',
                    values: [2012, 2013, 2014, 2015, 2016, 2017],                       
                    range: false,
                    set: [5],
                    tooltip: false,
                    onChange: function (vals) {
                        console.log(vals);
                    }
                });

                /*var slider3 = new rSlider({
                    target: '#slider3',
                    values: {min: 0, max: 100},
                    step: 10,
                    range: true,
                    set: [10, 40],
                    scale: true,
                    labels: false,
                    onChange: function (vals) {
                        console.log(vals);
                    }
                });*/

                var slider = new rSlider({
                    target: '#slider',
                    values: ["januar ", "februar", "marec ", "april ", "maj ", "jun ", "jul ", "august ", "september ", "oktober ", "november ", "december"],
                    range: false,
                    set: ["januar"],
                    onChange: function (vals) {
                        console.log(vals);
                    }
                });
				
				
				
				/*<div class="container">
    <div class="options">
        <label>timestamp </label><input type="range" id="timestamp" value="25" min="0" max="60" /><br />
    </div>
    <canvas id="canvas" width="100" height="1"></canvas>
</div>*/


            };
            window.onload = init;
        })();
    </script> 
  
  
  
  
  
  



<script src="js/d3.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>


<script>
d3.select(window).on("resize", throttle);

var zoom = d3.behavior.zoom()
    .scaleExtent([1, 9])
    .on("zoom", move);







var width = document.getElementById('container').offsetWidth;
var height = width / 2;

var topo,projection,path,svg,g;

var graticule = d3.geo.graticule();

var tooltip = d3.select("#container").append("div").attr("class", "tooltip hidden");

setup(width,height);

function setup(width,height){
  projection = d3.geo.mercator()
    .translate([(width/2), (height/2)])
    .scale( width / 2 / Math.PI);

  path = d3.geo.path().projection(projection);

  svg = d3.select("#container").append("svg")
      .attr("width", width)
      .attr("height", height)
      .call(zoom)
      .on("click", click)
      .append("g");

  g = svg.append("g");

}

d3.json("data/world-topo-min.json", function(error, world) {

  var countries = topojson.feature(world, world.objects.countries).features;

  topo = countries;
  draw(topo);

});

function draw(topo) {

  svg.append("path")
     .datum(graticule)
     .attr("class", "graticule")
     .attr("d", path);


  g.append("path")
   .datum({type: "LineString", coordinates: [[-180, 0], [-90, 0], [0, 0], [90, 0], [180, 0]]})
   .attr("class", "equator")
   .attr("d", path);


  var country = g.selectAll(".country").data(topo);
  //var citytip = g.selectAll(".city").data(topo);
  

  country.enter().insert("path")
      .attr("class", "country")
      .attr("d", path)
      .attr("id", function(d,i) { return d.id; })
      .attr("title", function(d,i) { return d.properties.name; })
	  .style("fill", "white");
      //.style("fill", function(d, i) { return d.properties.color; });

  //offsets for tooltips
  var offsetL = document.getElementById('container').offsetLeft+20;
  var offsetT = document.getElementById('container').offsetTop+10;

  //tooltips
  /*country
    .on("mousemove", function(d,i) {

      var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );

      tooltip.classed("hidden", false)
             .attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+offsetT)+"px")
             .html(d.properties.name);

      })
      .on("mouseout",  function(d,i) {
        tooltip.classed("hidden", true);
      }); */
	  
	  
	
	
	/*country
    .on("mousemove", function(d,i) {

      var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );

      tooltip.classed("hidden", false)
             .attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+offsetT)+"px")
             .html(d.properties.name);

      })
      .on("mouseout",  function(d,i) {
        tooltip.classed("hidden", true);
      }); */
	  
	  


  //EXAMPLE: adding some capitals from external CSV file
  /*d3.csv("data/country-capitals.csv", function(err, capitals) {

    capitals.forEach(function(i){
      addpoint(i.CapitalLongitude, i.CapitalLatitude, i.CapitalName );
    });

  });*/
  
  
  d3.csv("city_attributes.csv", function(err, cityData) {

    cityData.forEach(function(i){
      addpoint(i.Longitude, i.Latitude, i.City )
			
		
	  //addpoint(i.Longitude, i.Latitude, i.City )
	
		
    });

  });
  
  
  
    /*d3.csv("city_attributes.csv", function(error, data) {
		svg.selectAll("circle")
		   .data(data)
		   .enter()
		   .append("a")
					  .attr("xlink:href", function(d) {
						  return "https://www.google.com/search?q="+d.city;}
					  )
		   .append("circle")
		   .attr("cx", function(d) {
				   return projection([d.Longitude, d.Latitude])[0];
		   })
		   .attr("cy", function(d) {
				   return projection([d.Longitude, d.Latitude])[1];
		   })
		   .attr("r", 5)
		   .style("fill", "red")
		   .append("svg:title")
			.text(function(d) { return d.City; });
		   
		   /*.on("mouseover", function() {
				d3.select(this).enter().append("text")
					.text(function(d) {return d.City;})
					.attr("x", function(d) {return x(d.Latitude);})
					.attr("y", function (d) {return y(d.Longitude);});*
	});*/
	
	
	
	
	
	
  
  

}



/*function loadHeatmap(csv) {
			var pointArray = new google.maps.MVCArray(csv);

			if(heatmap) heatmap.setMap(null);
			
			heatmap = new google.maps.visualization.HeatmapLayer({
				data: pointArray,
				radius: $("#radius-slider").slider("value"),
				opacity: $("#opacity-slider").slider("value")
			});
			
			heatmap.setMap(map);
}*/

















function redraw() {
  width = document.getElementById('container').offsetWidth;
  height = width / 2;
  d3.select('svg').remove();
  setup(width,height);
  draw(topo);
}


function move() {

  var t = d3.event.translate;
  var s = d3.event.scale; 
  zscale = s;
  var h = height/4;


  t[0] = Math.min(
    (width/height)  * (s - 1), 
    Math.max( width * (1 - s), t[0] )
  );

  t[1] = Math.min(
    h * (s - 1) + h * s, 
    Math.max(height  * (1 - s) - h * s, t[1])
  );

  zoom.translate(t);
  g.attr("transform", "translate(" + t + ")scale(" + s + ")");

  //adjust the country hover stroke width based on zoom level
  d3.selectAll(".country").style("stroke-width", 1.5 / s);

}



var throttleTimer;
function throttle() {
  window.clearTimeout(throttleTimer);
    throttleTimer = window.setTimeout(function() {
      redraw();
    }, 200);
}


//geo translation on mouse click in map
function click() {
  var latlon = projection.invert(d3.mouse(this));
  console.log(latlon);
}


//function to add points and text to the map (used in plotting capitals)
function addpoint(lat,lon,text) {

  var gpoint = g.append("g").attr("class", "gpoint");
  var x = projection([lat,lon])[0];
  var y = projection([lat,lon])[1];

  gpoint.append("svg:circle")
        .attr("cx", x)
        .attr("cy", y)
        .attr("class","point")
        .attr("r", 1.5);
		/*.append("svg:title")
			.text(function(d) { return d.City; })*/;
		//.attr("title", function(d,i) { return d.City; });

		


  //conditional in case a point has no associated text
  if(text.length>0){

    gpoint.append("text")
          .attr("x", x+2)
          .attr("y", y+2)
          .attr("class","text")
          .text(text);
		  
		  
		 
		  
  }

}







</script>






	
	
	
	
	
	
	
	
	
	
	
	
	
	
		

	
	
	
	
	
	<div class="containerDiag"></div>
       
	   
       <script>
		
			document.getElementsByTagName("head")[0].appendChild(document.createElement('script', src='js/dataprocessing.js'));
			document.getElementsByTagName("head")[0].appendChild(document.createElement('script', src='js/grid.js'));
			document.getElementsByTagName("head")[0].appendChild(document.createElement('script', src='js/heatmap.js'));

			Array.prototype.max = function() {
				return Math.max.apply(null, this);
			};
			
			Array.prototype.min = function() {
				return Math.min.apply(null, this);
			};

			var scene = new THREE.Scene();

			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
			var ortoCamera = new THREE.OrthographicCamera( 40 / - 2, 40 / 2, 40 / 2, 40 / - 2, 0.1, 1000 );
			var activeCamera = camera;

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );
			
			var labelRenderer = new THREE.CSS2DRenderer();
			labelRenderer.setSize( window.innerWidth, window.innerHeight );
			labelRenderer.domElement.style.position = 'relative';                    //tu davaj bacha
			labelRenderer.domElement.style.top = 0;
			document.body.appendChild( labelRenderer.domElement );

			var controls = new THREE.OrbitControls(activeCamera, labelRenderer.domElement);

 			scene.background = new THREE.Color("rgb("+ 128 + "," + 128 + "," + 128 + ")");

			var values = [];
			for (var i = 0; i < 12; ++i)
				{
				for (var j = 0; j < 6; ++j)
				{
					values.push(Math.random() * 45 - 10 );
				}
			}

			var csvName = '';
			var cityName = '';
			var heatmapMaterial = undefined;

			var gui = new dat.GUI();
			var cameraSwitch = gui.add(this, "activeCamera", {Free: 0, XY: 1, XZ: 2, YZ: 3}).name("view");
			/*var citySwitch = gui.add(this, "cityName", {Vancouver: 'Vancouver', Portland: 'Portland', SanFrancisco: 'San Francisco', Seattle: 'Seattle', LosAngeles: 'Los Angeles', SanDiego: 'San Diego', LasVegas: 'Las Vegas', Phoenix: 'Phoenix', Albuquerque: 'Albuquerque', Denver: 'Denver', SanAntonio: 'San Antonio', Dallas: 'Dallas', Houston: 'Houston', KansasCity: 'Kansas City', Minneapolis: 'Minneapolis', SaintLouis: 'Saint Louis', Chicago: 'Chicago', Nashville: 'Nashville', Indianapolis: 'Indianapolis', Atlanta: 'Atlanta', Detroit: 'Detroit', Jacksonville:'Jacksonville', Charlotte: 'Charlotte', Miami: 'Miami', Pittsburgh: 'Pittsburgh', Toronto: 'Toronto', Philadelphia: 'Philadelphia', NewYork: 'New York', Montreal: 'Montreal', Boston: 'Boston', Beersheba: 'Beersheba', TelAvivDistrict: 'Tel Aviv District', Eilat: 'Eilat', Haifa: 'Haifa', Nahariyya: 'Nahariyya', Jerusalem: 'Jerusalem'
}).name("city");*/
			var attributeSwitch = gui.add(this, "csvName", {Temperature: 'temperature', Humidity: 'humidity'
				, Pressure: 'pressure', WindSpeed: 'wind_speed'}).name("attribute");
			var alphaSetter;
						
			var activeCameraI = 0;

			camera.position.z = 30;
			ortoCamera.position.z = 30;

			cameraSwitch.onChange(function onChange(value) {
				activeCameraI = value;

				if (activeCameraI == 0) {
					activeCamera = camera;
				}
				else
				{
					activeCamera = ortoCamera;

					if (activeCameraI == 1)
					{
						ortoCamera.rotation.x = 0;
						ortoCamera.rotation.y = 0;
						
						ortoCamera.position.x = 0;
						ortoCamera.position.y = 0;
						ortoCamera.position.z = 30;
					}
					else if (activeCameraI == 2)
					{
						ortoCamera.rotation.x = THREE.Math.degToRad(-90);
						ortoCamera.rotation.y = 0;
						
						ortoCamera.position.x = 0;
						ortoCamera.position.y = 30;
						ortoCamera.position.z = 0;
					}
					else if (activeCameraI == 3)
					{
						ortoCamera.rotation.x = 0;
						ortoCamera.rotation.y = THREE.Math.degToRad(-90);
						
						ortoCamera.position.x = -30;
						ortoCamera.position.y = 0;
						ortoCamera.position.z = 0;
					}
				}
			});

			var heatmap;



			
			attributeSwitch.onChange(function onChange(value) {
				var data = new Array(6 * 12);
				d3.csv("data/" + value + ".csv", function(error, data) {
					var startingMonth = Number(data[0].datetime.slice(5,7));
					var lastMonth = startingMonth;
					var monthTemp = Number(data[0].Portland);
					var month = 0;

					for (var i = 0; i < startingMonth; ++i)
						values[i] = undefined;

					for (var i = 1, c = 1; i < data.length; i++, c++) {
						if (Number(data[i].datetime.slice(5,7)) != lastMonth)
						{
							values[startingMonth + month] = (monthTemp / c - (value == 'temperature' ? 272.15 : 0));

							//fill previous unknown values
							if (startingMonth + month - 12 >= 0 && values[startingMonth - 12 + month] == undefined) {
								for (var toFill = startingMonth + month - 12; toFill >= 0; toFill -= 12)
								values[toFill] = (monthTemp / c - (value == 'temperature' ? 272.15 : 0));
							}


							monthTemp = 0;
							c = 0;

							lastMonth = Number(data[i].datetime.slice(5,7));
							month++;
						}

						monthTemp += Number(data[i].Portland);
					}

					//fill the rest
					for (; month + startingMonth < 6 * 12; ++month) {
						values[month + startingMonth] = values[month + startingMonth - 12];
					}

					if (heatmap == undefined)
					{
						heatmap = new Heatmap([30, 10, 20], [12, 6, 5], 12, 6, values.min(), values.max(), values, ['months', csvName, 'years'],  [['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'], 
							[2015, 2016, 2017, 2018, 2019, 2020]],scene);

						heatmapMaterial = heatmap.mesh.material;
						alphaSetter = gui.add(heatmap, "alpha", 0, 1).name("transparency");

						alphaSetter.onChange(function(value) {
							heatmap.mesh.material.uniforms.alpha.value = value;
							heatmap.mesh.material.needsUpdate = true;
						});
					}
					else
						heatmap.updateHeightmap(csvName, values.min(), values.max(), values);
				});
			});

			

			var animate = function () {
				requestAnimationFrame( animate );
				
				if (heatmap != undefined)
					heatmap.mesh.material.needsUpdate = true;

				renderer.render( scene, activeCamera );
				labelRenderer.render( scene, activeCamera );
			}

			animate();
		</script> 
        
        
        
    
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
















</body>
</html>